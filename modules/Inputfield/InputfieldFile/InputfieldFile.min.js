$(document).ready(function(){$(document).on("change",".InputfieldFileDelete input",function(){a($(this))}).on("dblclick",".InputfieldFileDelete",function(){var j=$(this).find("input");var i=$(this).parents(".InputfieldFileList").find(".InputfieldFileDelete input");if(j.is(":checked")){i.removeAttr("checked").change()}else{i.attr("checked","checked").change()}return false});function a(k){var i=k.parents(".InputfieldFileInfo");var j=k.closest(".InputfieldFile").hasClass("InputfieldItemListCollapse");if(k.is(":checked")){i.addClass("ui-state-error");if(!j){i.siblings(".InputfieldFileData").slideUp("fast")}}else{i.removeClass("ui-state-error");if(!j){i.siblings(".InputfieldFileData").slideDown("fast")}}}function c(i){i.each(function(){var k=$(this);var l=k.children("li").length;if(k.closest(".InputfieldRenderValueMode").length){return}var j=k.closest(".Inputfield");if(l<2){if(l==0){j.addClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple InputfieldFileSingle")}else{j.addClass("InputfieldFileSingle").removeClass("InputfieldFileEmpty InputfieldFileMultiple")}return}else{k.closest(".Inputfield").removeClass("InputfieldFileSingle InputfieldFileEmpty").addClass("InputfieldFileMultiple")}k.sortable({start:function(n,m){m.item.children(".InputfieldFileInfo").addClass("ui-state-highlight")},stop:function(n,m){$(this).children("li").each(function(o){$(this).find(".InputfieldFileSort").val(o)});m.item.children(".InputfieldFileInfo").removeClass("ui-state-highlight");j.addClass("InputfieldFileJustSorted InputfieldStateChanged");setTimeout(function(){j.removeClass("InputfieldFileJustSorted")},500)}})}).find(".ui-widget-header, .ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}function d(){$("body").addClass("ie-no-drop");$(document).on("change",".InputfieldFileUpload input[type=file]",function(){var l=$(this);var s=l.closest(".InputMask");if(l.val().length>1){s.addClass("ui-state-disabled")}else{s.removeClass("ui-state-disabled")}if(s.next(".InputMask").length>0){return}var i=l.closest(".InputfieldFile");var n=l.closest(".InputfieldFileUpload");var m=i.find(".InputfieldFileList");var r=parseInt(n.find(".InputfieldFileMaxFiles").val());var k=m.children("li").length+n.find("input[type=file]").length+1;if(r>0&&k>=r){}else{n.find(".InputMask").not(":last").each(function(){var t=$(this);if(t.find("input[type=file]").val()<1){t.remove()}});var q=s.clone().removeClass("ui-state-disabled");var p=q.find("input[type=file]");p.attr("id",p.attr("id")+"-");p.val("");q.insertAfter(s);q.css("margin-left","0.5em").removeClass("ui-state-active")}var j=l.val();var o=j.lastIndexOf("/");if(o===-1){o=j.lastIndexOf("\\")}j=j.substring(o+1);s.find(".ui-button-text").text(j).prepend("<i class='fa fa-fw fa-file-o'></i>");s.removeClass("ui-state-active")})}function f(j){if(j.length>0){var i=j.find(".InputfieldFileUpload")}else{var i=$(".InputfieldFileUpload")}i.closest(".InputfieldContent").each(function(l){if($(this).hasClass("InputfieldFileInit")){return}k($(this),l);$(this).addClass("InputfieldFileInit")});function k(s,A){var r=s.parents("form");var l=s.closest(".InputfieldRepeaterItem");var o=l.length?l.attr("data-editUrl"):r.attr("action");o+=(o.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var E=r.find("input._post_token");var q=E.attr("name");var v=E.val();var C=s.find(".InputfieldFileUpload");var n=C.data("fieldname");n=n.slice(0,-2);var D=C.data("extensions").toLowerCase();var z=C.data("maxfilesize");var u=s.find("input[type=file]").get(0);var t=s.get(0);var m=s.find(".InputfieldFileList");if(m.size()<1){m=$("<ul class='InputfieldFileList InputfieldFileListBlank'></ul>");s.prepend(m);s.parent(".Inputfield").addClass("InputfieldFileEmpty")}var B=m.get(0);var w=parseInt(s.find(".InputfieldFileMaxFiles").val());m.children().addClass("InputfieldFileItemExisting");s.find(".AjaxUploadDropHere").show();var x=null;function p(H){var K=$('<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader"></p></li>'),J=$('<div class="ui-progressbar ui-widget ui-widget-content ui-corner-all" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>'),I=$('<div class="ui-progressbar-value ui-widget-header InputfieldItemHeader ui-corner-left" style="width: 0%; "></div>'),L,M,O,N;J.append(I);K.append(J);O=new XMLHttpRequest();O.upload.addEventListener("progress",function(P){if(P.lengthComputable){var Q=(P.loaded/P.total)*100;I.width(Q+"%");if(Q>4){I.html("<span>"+parseInt(Q)+"%</span>")}$("body").addClass("pw-uploading")}else{}},false);O.addEventListener("load",function(){O.getAllResponseHeaders();var V=$.parseJSON(O.responseText);if(V.error!==undefined){V=[V]}for(var T=0;T<V.length;T++){var Q=V[T];if(Q.error){var U=K.clone();U.find(".InputfieldFileInfo").addClass("ui-state-error");U.find(".InputfieldFileStats").text(" - "+Q.message);U.find(".ui-progressbar").remove();K.after(U)}else{if(Q.replace){var S=s.find(".InputfieldFileList").children("li:eq(0)");if(S.size()>0){S.slideUp("fast",function(){S.remove()})}}var aa=s.find("input[type=file]");if(aa.val()){aa.replaceWith(aa.clone(true))}var X=$(Q.markup);X.hide();if(Q.overwrite){var Z=X.find(".InputfieldFileName").text();var ab=null;m.children(".InputfieldFileItemExisting").each(function(){if(ab===null&&$(this).find(".InputfieldFileName").text()==Z){ab=$(this)}});if(ab!==null){var W=X.find(".InputfieldFileInfo");var P=X.find(".InputfieldFileLink");var R=ab.find(".InputfieldFileInfo");var Y=ab.find(".InputfieldFileLink");R.html(W.html()+"<i class='fa fa-check'></i>");Y.html(P.html());ab.addClass("InputfieldFileItemExisting");ab.effect("highlight",500)}else{m.append(X);X.slideDown();X.addClass("InputfieldFileItemExisting")}}else{m.append(X);X.slideDown()}}}K.remove();if(x){clearTimeout(x)}x=setTimeout(function(){$("body").removeClass("pw-uploading");if(w!=1&&!m.is(".ui-sortable")){c(m)}m.trigger("AjaxUploadDone")},500)},false);O.open("POST",o,true);O.setRequestHeader("X-FILENAME",encodeURIComponent(H.name));O.setRequestHeader("X-FIELDNAME",n);O.setRequestHeader("Content-Type","application/octet-stream");O.setRequestHeader("X-"+q,v);O.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");O.send(H);N="<i class='fa fa-fw fa-spin fa-spinner'></i> <span class=\"InputfieldFileName\">"+H.name+'</span><span class="InputfieldFileStats"> &bull; '+parseInt(H.size/1024,10)+" kb</span>";K.find("p.ui-widget-header").html(N);m.append(K);var F=m.closest(".Inputfield");F.addClass("InputfieldStateChanged");var G=F.find(".InputfieldFileItem").length;if(G==1){F.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(G>1){F.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}function y(H){function I(K,L){return'<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader ui-state-error">&nbsp; '+K+' <span class="InputfieldFileStats"> &bull; '+L+"</span></p></li>"}if(typeof H!=="undefined"){for(var G=0,F=H.length;G<F;G++){var J=H[G].name.split(".").pop().toLowerCase();if(D.indexOf(J)==-1){m.append(I(H[G].name,J+" is a invalid file extension, please use one of:  "+D))}else{if(H[G].size>z&&z>2000000){m.append(I(H[G].name,"Filesize "+parseInt(H[G].size/1024,10)+" kb is too big. Maximum allowed is "+parseInt(z/1024,10)+" kb"))}else{p(H[G])}}if(w==1){break}}}else{B.innerHTML="No support for the File API in this web browser"}}u.addEventListener("change",function(F){y(this.files);F.preventDefault();F.stopPropagation();this.value=""},false);t.addEventListener("dragleave",function(){$(this).removeClass("ui-state-hover");$(this).closest(".Inputfield").removeClass("pw-drag-in-file")},false);t.addEventListener("dragenter",function(){$(this).addClass("ui-state-hover");$(this).closest(".Inputfield").addClass("pw-drag-in-file")},false);t.addEventListener("dragover",function(F){if(!$(this).is("ui-state-hover")){$(this).addClass("ui-state-hover");$(this).closest(".Inputfield").addClass("pw-drag-in-file")}F.preventDefault();F.stopPropagation()},false);t.addEventListener("drop",function(F){y(F.dataTransfer.files);$(this).removeClass("ui-state-hover").closest(".Inputfield").removeClass("pw-drag-in-file");F.preventDefault();F.stopPropagation()},false)}}c($(".InputfieldFileList"));var e=false;if(window.File&&window.FileList&&window.FileReader&&($("#PageIDIndicator").length>0||$(".InputfieldAllowAjaxUpload").length>0)){f("");e=true}else{d()}var h=767;var g=false;var b=function(){if(!e){return}$(".AjaxUploadDropHere").each(function(){var i=$(this);if(i.parent().width()<=h){i.hide()}else{i.show()}});g=false};if(e){$(window).resize(function(){if(g){return}g=true;setTimeout(b,1000)}).resize()}$(document).on("reloaded",".InputfieldHasFileList",function(i){c($(this).find(".InputfieldFileList"));f($(this));if(e){b()}})});