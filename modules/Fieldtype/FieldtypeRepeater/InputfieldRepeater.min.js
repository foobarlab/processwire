function InputfieldRepeater(i){var b=50;var x=i("body").hasClass("AdminThemeReno");var v=null;var c=function(A,B){if(typeof B!="undefined"){if(B=="InputfieldRepeaterItemEdit"||B=="InputfieldRepeaterItemAdd"){A.stopPropagation();var z=i(this).find(".InputfieldRepeater");if(z.length){w(z)}return}}w(i(this))};var k=function(F){var E=i(this);var C=E.closest(".InputfieldHeader");var B=C.parent();if(g(E)){return false}if(B.hasClass("InputfieldRepeaterNewItem")){var z=B.children(".InputfieldContent").children(".InputfieldRepeaterAddItem").children("input");z.attr("value",parseInt(z.attr("value")-1));B.remove()}else{var A=B.attr("data-page");var D=B.find("#delete_repeater"+A);if(D.is(":checked")){D.removeAttr("checked");C.removeClass("ui-state-error").addClass("ui-state-default");B.removeClass("InputfieldRepeaterDeletePending")}else{D.attr("checked","checked");C.removeClass("ui-state-default").addClass("ui-state-error");if(!B.hasClass("InputfieldStateCollapsed")){C.find(".toggle-icon").click()}B.addClass("InputfieldRepeaterDeletePending")}C.find(".InputfieldRepeaterItemControls").css("background-color",C.css("background-color"))}l(B.closest(".InputfieldRepeater"));F.stopPropagation()};var o=function(){var B=i(this);var C=i(this).closest("li");var z=C.hasClass("InputfieldRepeaterDeletePending");if(g(B)){return false}function A(){C.parent().children("li").each(function(){var D=i(this);var E=D.children(".InputfieldHeader").find(".InputfieldRepeaterTrash");if(D.hasClass("InputfieldRepeaterDeletePending")){if(z){E.click()}}else{if(!z){E.click()}}})}if(z){A()}else{ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.removeAll,A)}};var e=function(){var A=i(this);if(g(A)){return false}var z=A.closest(".InputfieldRepeaterItem");ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.clone,function(){var C=z.attr("data-page");var B=z.closest(".InputfieldRepeater").children(".InputfieldContent").children(".InputfieldRepeaterAddItem").find(".InputfieldRepeaterAddLink:eq(0)");B.attr("data-clone",C).click();i("html, body").animate({scrollTop:B.offset().top-100},250,"swing")});return false};var u=function(D){var C=i(this);var B=C.attr("data-on");var z=C.attr("data-off");var A=C.closest(".InputfieldRepeaterItem");var E=A.find(".InputfieldRepeaterPublish");if(v){clearTimeout(v)}v=setTimeout(function(){if(g(C)){return false}if(C.hasClass(B)){C.removeClass(B).addClass(z);A.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");E.val("-1")}else{C.removeClass(z).addClass(B);A.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");E.val("1")}l(A.closest(".InputfieldRepeater"))},250);D.stopPropagation()};var f=function(){var z=i(this);var A=z.find(".InputfieldRepeaterLoaded");if(parseInt(A.val())>0){return}z.addClass("InputfieldRepeaterItemLoading")};var y=function(){var G=i(this);var J=G.find(".InputfieldRepeaterLoaded");d(G);if(parseInt(J.val())>0){r(G);return}J.val("1");var A=G.find(".InputfieldContent").hide();var C=G.closest(".InputfieldRepeater");var F=C.attr("data-page");var B=parseInt(G.attr("data-page"));var I=C.attr("id");var H=I.replace("wrap_Inputfield_","");var z=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+F+"&field="+H+"&repeater_edit="+B;var D=G.find(".InputfieldRepeaterDrag");var E=J.closest(".Inputfields");D.removeClass("fa-arrows").addClass("fa-spin fa-spinner");I=I.replace(/_repeater\d+$/,"");i.get(z,function(M){var K=i(M).find("#"+I+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");E.append(K);G.removeClass("InputfieldRepeaterItemLoading");InputfieldsInit(E);var L=K.filter(".InputfieldRepeater");if(L.length){L.each(function(){w(i(this))})}A.slideDown("fast",function(){D.removeClass("fa-spin fa-spinner").addClass("fa-arrows");r(G)});setTimeout(function(){E.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])},50)})};var j=function(){d(i(this))};var n=function(){var C=i(this);var I=C.parent("p").prev("ul.Inputfields");var A=C.closest(".InputfieldRepeater");var D=C.parent().children("input");var H=0;var N=C.attr("data-noajax").length==0;var B=C.attr("data-clone");function L(O){var P=O.attr("id")+"_";while(i("#"+P).length>0){P+="_"}O.attr("id",P);I.append(O);O.css("display","block");h(O,true);C.trigger("repeateradd",[O])}if(typeof B=="undefined"||!B){B=null}if(B){C.removeAttr("data-clone")}if(!N){var E=I.children(".InputfieldRepeaterNewItem");H=E.length;if(H>0){if(H>1){E=E.slice(0,1)}var G=E.clone(true);L(G);D.attr("value",H);l(A)}return false}var J=A.attr("data-page");var M=A.attr("id").replace("wrap_Inputfield_","");var F=C.parent().find(".InputfieldRepeaterSpinner");var z=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+J+"&field="+M;F.removeClass(F.attr("data-off")).addClass(F.attr("data-on"));if(B){z+="&repeater_clone="+B}else{z+="&repeater_add="+C.attr("data-type")}var K=I.find(".InputfieldRepeaterUnpublished:not(.InputfieldRepeaterMinItem)");if(K.length){z+="&repeater_not=";K.each(function(){z+=i(this).attr("data-page")+","})}i.get(z,function(Q){F.removeClass(F.attr("data-on")).addClass(F.attr("data-off"));var O=i(Q).find(".InputfieldRepeaterItemRequested");if(!O.length){return}L(O);O.wrap("<div />");InputfieldsInit(O.parent());w(O);O.unwrap();O.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]);O.find(".InputfieldRepeaterSort").val(I.children().length);i("html, body").animate({scrollTop:O.offset().top},500,"swing");d(O);l(A);r(O);var P=O.find(".InputfieldRepeater");if(P.length){P.each(function(){w(i(this))})}});return false};var q=function(D){D.stopPropagation();D.preventDefault();if(v){clearTimeout(v)}if(i(this).closest(".InputfieldRepeater").hasClass("InputfieldRepeaterAccordion")){return false}var B=i(this).closest(".InputfieldRepeater");var E=B.children(".InputfieldContent").children(".Inputfields").children(".InputfieldRepeaterItem");if(!E.length){return false}var A=E.eq(0);if(A.hasClass("InputfieldStateCollapsed")){var C=ProcessWire.config.InputfieldRepeater.labels.openAll;var z=".InputfieldStateCollapsed"}else{var C=ProcessWire.config.InputfieldRepeater.labels.collapseAll;var z=".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)"}ProcessWire.confirm(C,function(){E.filter(z).each(function(){i(this).children(".InputfieldHeader").find(".toggle-icon").click()})});return false};function g(z){if(z.hasClass("pw-icon-disabled")){ProcessWire.alert(ProcessWire.config.InputfieldRepeater.labels.disabledMinMax);return true}return false}function r(z){if(!z.closest(".InputfieldRepeater").hasClass("InputfieldRepeaterAccordion")){return false}var D=z.attr("id");var B=false;var A=z.parent().children(".InputfieldRepeaterItem");var C=false;var E=false;A.each(function(){var F=i(this);if(F.attr("id")==D){C=true;return}if(F.hasClass("InputfieldStateCollapsed")){return}if(!F.is(":visible")){return}if(!C){B=true}F.children(".InputfieldHeader").find(".toggle-icon").trigger("click",[{duration:0}]);E=true});if(B&&E){i("html, body").animate({scrollTop:z.offset().top-10},0)}return true}function h(B,D){var A;A=B.children(".InputfieldHeader").find(".InputfieldRepeaterItemLabel");if(typeof A=="undefined"){A=B.children("label")}var E=A.html();var z=E;if(typeof E!="undefined"){if(D&&E.indexOf("#")>-1){var C=B.siblings(".InputfieldRepeaterItem:visible").length+1;E=E.replace(/#[0-9]+/,"#"+C)}while(E.indexOf("}")>-1){E=E.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">');E=E.replace(/}/,"</span>")}if(E!=z){A.html(E)}}}function m(B,F,A){var z=B.item.find(".InputfieldRepeaterDepth");var D=-1;var E=parseInt(z.val());var C=B.position.left;if(x){C-=b}if(C<0){D=E-Math.round(Math.abs(C)/b)}else{D=Math.round(C/b)+E}if(D<1){D=0}else{if(D>F){D=F}}if(A){if(D){B.item.css("margin-left",(D*b)+"px")}else{B.item.css("margin-left",0)}z.val(D);B.item.children(".InputfieldHeader").removeClass("ui-state-error")}return D}function p(z){z.find(".InputfieldRepeaterDepth").each(function(){var C=i(this);var D=C.val();var A=C.closest(".InputfieldRepeaterItem");var B=A.css("margin-left");if(B=="auto"){B=0}B=parseInt(B);var E=D*b;if(E!=B){A.css("margin-left",E+"px")}})}function a(C,z){var B=parseInt(C.attr("data-depth"));var A={items:"> li:not(.InputfieldRepeaterNewItem)",handle:".InputfieldRepeaterDrag",start:function(E,D){D.item.find(".InputfieldHeader").addClass("ui-state-highlight");D.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each(function(){i(this).removeClass("InputfieldCKEditorLoaded");var F=CKEDITOR.instances[i(this).attr("id")];F.destroy();CKEDITOR.remove(i(this).attr("id"))});D.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceRemoveControl",false,i(this).attr("id"))})},stop:function(E,D){if(B>0){m(D,B,true)}D.item.find(".InputfieldHeader").removeClass("ui-state-highlight");i(this).children().each(function(F){i(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",F)});D.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){i(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])});D.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceAddControl",false,i(this).attr("id"))})}};if(B>0){p(C);A.grid=[b,1];A.sort=function(E,F){var G=m(F,99,false);var D=F.item.children(".InputfieldHeader");if(G>B){D.addClass("ui-state-error")}else{if(D.hasClass("ui-state-error")){D.removeClass("ui-state-error")}}}}else{A.axis="y"}i(".InputfieldRepeaterDrag",z).hover(function(){i(this).parent("label").addClass("ui-state-focus")},function(){i(this).parent("label").removeClass("ui-state-focus")});z.sortable(A)}function t(E,G,D){var F=i("<i class='fa fa-copy InputfieldRepeaterClone'></i>").css("display","block");var A=i("<i class='fa fa-trash InputfieldRepeaterTrash'></i>");var C=i("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>");var z=ProcessWire.config.InputfieldRepeater;var B=!G.hasClass("InputfieldRepeaterNoAjaxAdd");if(z){C.attr("title",z.labels.toggle);A.attr("title",z.labels.remove);F.attr("title",z.labels.clone)}E.each(function(){var N=i(this);if(N.hasClass("InputfieldRepeaterHeaderInit")){return}var M="fa-arrows";var K=N.parent();if(K.hasClass("InputfieldRepeaterNewItem")){M="fa-plus";N.addClass("ui-priority-secondary")}N.addClass("ui-state-default InputfieldRepeaterHeaderInit");N.prepend("<i class='fa fa-fw "+M+" InputfieldRepeaterDrag'></i>");if(!D){var H=i("<span class='InputfieldRepeaterItemControls'></span>");var J=C.clone(true).addClass(N.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on");var L=A.clone(true);var I=N.find(".toggle-icon");H.prepend(I);if(B){H.prepend(F.clone(true))}H.prepend(J).prepend(L);N.prepend(H);H.css("background-color",N.css("background-color"))}h(K,false)})}function w(C){if(C.hasClass("InputfieldRepeaterItem")){var z=C;var D=C.closest(".InputfieldRepeater");var B=true}else{var z=C.find(".Inputfields:eq(0)");var D=C;var B=false}if(z.hasClass("InputfieldRepeaterInit")){return}var A=z.closest(".InputfieldRenderValueMode").length>0;z.addClass("InputfieldRepeaterInit");i("input.InputfieldRepeaterDelete",C).parents(".InputfieldCheckbox").hide();if(B){t(C.children(".InputfieldHeader"),D,A)}else{t(i(".InputfieldRepeaterItem > .InputfieldHeader",C),D,A)}if(A){p(D);return}i(".InputfieldRepeaterTrash",C).hover(function(){var E=i(this).closest("label");if(!E.parents().hasClass("InputfieldRepeaterDeletePending")){E.addClass("ui-state-error")}E.find(".InputfieldRepeaterItemControls").css("background-color",E.css("background-color"))},function(){var E=i(this).closest("label");if(!E.parent().hasClass("InputfieldRepeaterDeletePending")){E.removeClass("ui-state-error")}E.find(".InputfieldRepeaterItemControls").css("background-color",E.css("background-color"))});if(B){z=D.find(".Inputfields:eq(0)")}a(D,z);i(".InputfieldRepeaterAddLink:not(.InputfieldRepeaterAddLinkInit)",D).addClass("InputfieldRepeaterAddLinkInit").click(n);if(D.hasClass("InputfieldRepeaterMax")){l(D)}}function l(z){if(!z.hasClass("InputfieldRepeaterMax")&&!z.hasClass("InputfieldRepeaterMin")){return}var H=parseInt(z.attr("data-max"));var E=parseInt(z.attr("data-min"));if(H<=0&&E<=0){return}var A=z.children(".InputfieldContent");var F=A.children(".Inputfields").children("li:not(.InputfieldRepeaterDeletePending):not(.InputfieldRepeaterOff):visible").length;var D=A.children(".InputfieldRepeaterAddItem");var C="";var B="";if(H>0){if(F>=H){D.hide();C="hide"}else{if(!D.is(":visible")){D.show();C="show"}}}if(E>0){if(F<=E){B="hide";A.addClass("InputfieldRepeaterTrashHidden")}else{if(A.hasClass("InputfieldRepeaterTrashHidden")){A.removeClass("InputfieldRepeaterTrashHidden");B="show"}}}if(C.length||B.length){var G=A.children(".Inputfields").children(".InputfieldRepeaterItem");if(C.length){G.each(function(){var I=i(this).children(".InputfieldHeader").find(".InputfieldRepeaterClone");if(C==="show"){I.removeClass("pw-icon-disabled")}else{I.addClass("pw-icon-disabled")}})}if(B.length){G.each(function(){var J=i(this).children(".InputfieldHeader");var I=J.find(".InputfieldRepeaterTrash");var K=J.find(".InputfieldRepeaterToggle.fa-toggle-on");if(B==="show"){I.removeClass("pw-icon-disabled");K.removeClass("pw-icon-disabled")}else{I.addClass("pw-icon-disabled");K.addClass("pw-icon-disabled")}});if(B=="hide"){A.children(".Inputfields").children("li.InputfieldRepeaterDeletePending").each(function(){var I=i(this).children(".InputfieldHeader").find(".InputfieldRepeaterTrash");I.removeClass("pw-icon-disabled")})}}}}function d(z){if(z.closest(".InputfieldRepeaterRememberOpen").length<1){return}var A="";i(".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)").each(function(){var B=parseInt(i(this).attr("data-page"));if(B>0){A+=B+"|"}});i.cookie("repeaters_open",A)}function s(){i(".InputfieldRepeater").each(function(){w(i(this))});i(document).on("reloaded",".InputfieldRepeater",c).on("click",".InputfieldRepeaterTrash",k).on("dblclick",".InputfieldRepeaterTrash",o).on("click",".InputfieldRepeaterClone",e).on("dblclick",".InputfieldRepeaterToggle",q).on("click",".InputfieldRepeaterToggle",u).on("opened",".InputfieldRepeaterItem",y).on("closed",".InputfieldRepeaterItem",j).on("openReady",".InputfieldRepeaterItem",f)}s()}jQuery(document).ready(function(a){InputfieldRepeater(a)});