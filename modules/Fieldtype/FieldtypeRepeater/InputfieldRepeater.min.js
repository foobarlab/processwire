function InputfieldRepeater(i){var b=50;var t=i("body").hasClass("AdminThemeReno");var c=function(w,x){if(typeof x!="undefined"){if(x=="InputfieldRepeaterItemEdit"||x=="InputfieldRepeaterItemAdd"){w.stopPropagation();var v=i(this).find(".InputfieldRepeater");if(v.length){s(v)}return}}s(i(this))};var k=function(A){var y=i(this).closest(".InputfieldHeader");var x=y.parent();if(x.hasClass("InputfieldRepeaterNewItem")){var v=x.children(".InputfieldContent").children(".InputfieldRepeaterAddItem").children("input");v.attr("value",parseInt(v.attr("value")-1));x.remove()}else{var w=x.attr("data-page");var z=x.find("#delete_repeater"+w);if(z.is(":checked")){z.removeAttr("checked");y.removeClass("ui-state-error").addClass("ui-state-default");x.removeClass("InputfieldRepeaterDeletePending")}else{z.attr("checked","checked");y.removeClass("ui-state-default").addClass("ui-state-error");if(!x.hasClass("InputfieldStateCollapsed")){y.find(".toggle-icon").click()}x.addClass("InputfieldRepeaterDeletePending")}y.find(".InputfieldRepeaterItemControls").css("background-color",y.css("background-color"))}g(x.closest(".InputfieldRepeater"));A.stopPropagation()};var n=function(x){var y=i(this).closest("li");var v=y.hasClass("InputfieldRepeaterDeletePending");function w(){y.parent().children("li").each(function(){var z=i(this);var A=z.children(".InputfieldHeader").find(".InputfieldRepeaterTrash");if(z.hasClass("InputfieldRepeaterDeletePending")){if(v){A.click()}}else{if(!v){A.click()}}})}if(v){w()}else{ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.removeAll,w)}};var e=function(w){var v=i(this).closest(".InputfieldRepeaterItem");ProcessWire.confirm(ProcessWire.config.InputfieldRepeater.labels.clone,function(){var y=v.attr("data-page");var x=v.closest(".InputfieldRepeater").children(".InputfieldContent").children(".InputfieldRepeaterAddItem").find(".InputfieldRepeaterAddLink:eq(0)");x.attr("data-clone",y).click();i("html, body").animate({scrollTop:x.offset().top-100},250,"swing")});return false};var r=function(z){var y=i(this);var x=y.attr("data-on");var v=y.attr("data-off");var w=y.closest(".InputfieldRepeaterItem");var A=w.find(".InputfieldRepeaterPublish");if(y.hasClass(x)){y.removeClass(x).addClass(v);w.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");A.val("-1")}else{y.removeClass(v).addClass(x);w.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");A.val("1")}z.stopPropagation()};var f=function(x){var v=i(this);var w=v.find(".InputfieldRepeaterLoaded");if(parseInt(w.val())>0){return}v.addClass("InputfieldRepeaterItemLoading")};var u=function(B){var D=i(this);var G=D.find(".InputfieldRepeaterLoaded");d(D);if(parseInt(G.val())>0){return}G.val("1");var w=D.find(".InputfieldContent").hide();var y=D.closest(".InputfieldRepeater");var C=y.attr("data-page");var x=parseInt(D.attr("data-page"));var F=y.attr("id");var E=F.replace("wrap_Inputfield_","");var v=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+C+"&field="+E+"&repeater_edit="+x;var z=D.find(".InputfieldRepeaterDrag");var A=G.closest(".Inputfields");z.removeClass("fa-arrows").addClass("fa-spin fa-spinner");F=F.replace(/_repeater\d+$/,"");i.get(v,function(J){var H=i(J).find("#"+F+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");A.append(H);D.removeClass("InputfieldRepeaterItemLoading");InputfieldsInit(A);var I=H.filter(".InputfieldRepeater");if(I.length){I.each(function(){s(i(this))})}w.slideDown("fast",function(){z.removeClass("fa-spin fa-spinner").addClass("fa-arrows")});setTimeout(function(){A.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])},50)})};var j=function(v){d(i(this))};var m=function(F){var y=i(this);var E=y.parent("p").prev("ul.Inputfields");var w=y.closest(".InputfieldRepeater");var z=y.parent().children("input");var D=0;var K=y.attr("data-noajax").length==0;var x=y.attr("data-clone");function I(L){var M=L.attr("id")+"_";while(i("#"+M).length>0){M+="_"}L.attr("id",M);E.append(L);L.css("display","block");h(L,true);y.trigger("repeateradd",[L])}if(typeof x=="undefined"||!x){x=null}if(x){y.removeAttr("data-clone")}if(!K){var A=E.children(".InputfieldRepeaterNewItem");D=A.length;if(D>0){if(D>1){A=A.slice(0,1)}var C=A.clone(true);I(C);z.attr("value",D);g(w)}return false}var G=w.attr("data-page");var J=w.attr("id").replace("wrap_Inputfield_","");var B=y.parent().find(".InputfieldRepeaterSpinner");var v=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+G+"&field="+J;B.removeClass(B.attr("data-off")).addClass(B.attr("data-on"));if(x){v+="&repeater_clone="+x}else{v+="&repeater_add="+y.attr("data-type")}var H=E.find(".InputfieldRepeaterUnpublished");if(H.length){v+="&repeater_not=";H.each(function(){v+=i(this).attr("data-page")+","})}i.get(v,function(M){B.removeClass(B.attr("data-on")).addClass(B.attr("data-off"));var L=i(M).find(".InputfieldRepeaterItemRequested");if(!L.length){return}I(L);L.wrap("<div />");InputfieldsInit(L.parent());s(L);L.unwrap();L.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]);L.find(".InputfieldRepeaterSort").val(E.children().length);i("html, body").animate({scrollTop:L.offset().top},500,"swing");d(L);g(w);$nestedRepeaters=L.find(".InputfieldRepeater");if($nestedRepeaters.length){$nestedRepeaters.each(function(){s(i(this))})}});return false};var p=function(z){z.stopPropagation();z.preventDefault();var x=i(this).closest(".InputfieldRepeater");var A=x.children(".InputfieldContent").children(".Inputfields").children(".InputfieldRepeaterItem");if(!A.length){return false}var w=A.eq(0);if(w.hasClass("InputfieldStateCollapsed")){var y=ProcessWire.config.InputfieldRepeater.labels.openAll;var v=".InputfieldStateCollapsed"}else{var y=ProcessWire.config.InputfieldRepeater.labels.collapseAll;var v=".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)"}ProcessWire.confirm(y,function(){A.filter(v).each(function(){i(this).children(".InputfieldHeader").find(".toggle-icon").click()})});return false};function h(x,y){var w=x.children("label");var z=w.html();var v=z;if(y&&z.indexOf("#")>-1){num=x.siblings(".InputfieldRepeaterItem:visible").length+1;z=z.replace(/#[0-9]+/,"#"+num)}if(z.indexOf("{")>-1){z=z.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">');z=z.replace(/}/,"</span>")}if(z!=v){w.html(z)}}function l(x,B,w){var v=x.item.find(".InputfieldRepeaterDepth");var z=-1;var A=parseInt(v.val());var y=x.position.left;if(t){y-=b}if(y<0){z=A-Math.round(Math.abs(y)/b)}else{z=Math.round(y/b)+A}if(z<1){z=0}else{if(z>B){z=B}}if(w){if(z){x.item.css("margin-left",(z*b)+"px")}else{x.item.css("margin-left",0)}v.val(z);x.item.children(".InputfieldHeader").removeClass("ui-state-error")}return z}function o(v){v.find(".InputfieldRepeaterDepth").each(function(){var y=i(this);var z=y.val();var w=y.closest(".InputfieldRepeaterItem");var x=w.css("margin-left");if(x=="auto"){x=0}x=parseInt(x);var A=z*b;if(A!=x){w.css("margin-left",A+"px")}})}function a(y,v){var x=parseInt(y.attr("data-depth"));var w={items:"> li:not(.InputfieldRepeaterNewItem)",handle:".InputfieldRepeaterDrag",start:function(A,z){z.item.find(".InputfieldHeader").addClass("ui-state-highlight");z.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each(function(){i(this).removeClass("InputfieldCKEditorLoaded");var B=CKEDITOR.instances[i(this).attr("id")];B.destroy();CKEDITOR.remove(i(this).attr("id"))});z.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceRemoveControl",false,i(this).attr("id"))})},stop:function(A,z){if(x>0){l(z,x,true)}z.item.find(".InputfieldHeader").removeClass("ui-state-highlight");i(this).children().each(function(B){i(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",B)});z.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){i(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])});z.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceAddControl",false,i(this).attr("id"))})}};if(x>0){o(y);w.grid=[b,1];w.sort=function(A,B){var C=l(B,99,false);var z=B.item.children(".InputfieldHeader");if(C>x){z.addClass("ui-state-error")}else{if(z.hasClass("ui-state-error")){z.removeClass("ui-state-error")}}}}else{w.axis="y"}i(".InputfieldRepeaterDrag",v).hover(function(){i(this).parent("label").addClass("ui-state-focus")},function(){i(this).parent("label").removeClass("ui-state-focus")});v.sortable(w)}function s(E){if(E.hasClass("InputfieldRepeaterItem")){var A=E;var w=E.closest(".InputfieldRepeater");var z=true}else{var A=E.find(".Inputfields:eq(0)");var w=E;var z=false}if(A.hasClass("InputfieldRepeaterInit")){return}A.addClass("InputfieldRepeaterInit");var y=A.closest(".InputfieldRenderValueMode").length>0;var D=i("<i class='fa fa-copy InputfieldRepeaterClone'></i>").css("display","block");var B=i("<i class='fa fa-trash InputfieldRepeaterTrash'></i>");var v=i("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>");var C=ProcessWire.config.InputfieldRepeater;var x=!w.hasClass("InputfieldRepeaterNoAjaxAdd");if(C){v.attr("title",C.labels.toggle);B.attr("title",C.labels.remove);D.attr("title",C.labels.clone)}i("input.InputfieldRepeaterDelete",E).parents(".InputfieldCheckbox").hide();function F(G){G.each(function(){var N=i(this);if(N.hasClass("InputfieldRepeaterHeaderInit")){return}var M="fa-arrows";var K=N.parent();if(K.hasClass("InputfieldRepeaterNewItem")){M="fa-plus";N.addClass("ui-priority-secondary")}N.addClass("ui-state-default InputfieldRepeaterHeaderInit");N.prepend("<i class='fa fa-fw "+M+" InputfieldRepeaterDrag'></i>");if(!y){var H=i("<span class='InputfieldRepeaterItemControls'></span>");var J=v.clone(true).addClass(N.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on");var L=B.clone(true);var I=N.find(".toggle-icon");H.prepend(I);if(x){H.prepend(D.clone(true))}H.prepend(J).prepend(L);N.prepend(H);H.css("background-color",N.css("background-color"))}h(K,false)})}if(z){F(E.children(".InputfieldHeader"))}else{F(i(".InputfieldRepeaterItem > .InputfieldHeader",E))}if(y){o(w);return}i(".InputfieldRepeaterTrash",E).hover(function(){var G=i(this).closest("label");if(!G.parents().hasClass("InputfieldRepeaterDeletePending")){G.addClass("ui-state-error")}G.find(".InputfieldRepeaterItemControls").css("background-color",G.css("background-color"))},function(){var G=i(this).closest("label");if(!G.parent().hasClass("InputfieldRepeaterDeletePending")){G.removeClass("ui-state-error")}G.find(".InputfieldRepeaterItemControls").css("background-color",G.css("background-color"))});if(z){A=w.find(".Inputfields:eq(0)")}a(w,A);i(".InputfieldRepeaterAddLink:not(.InputfieldRepeaterAddLinkInit)",w).addClass("InputfieldRepeaterAddLinkInit").click(m);if(w.hasClass("InputfieldRepeaterMax")){g(w)}}function g(z){if(!z.hasClass("InputfieldRepeaterMax")){return}var v=parseInt(z.attr("data-max"));if(v<=0){return}var x=z.children(".InputfieldContent");var w=x.children(".Inputfields").children("li:not(.InputfieldRepeaterDeletePending)").length;var y=x.children(".InputfieldRepeaterAddItem");if(w>v){y.hide()}else{if(!y.is(":visible")){y.show()}}}function d(v){if(v.closest(".InputfieldRepeaterRememberOpen").length<1){return}var w="";i(".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)").each(function(){var x=parseInt(i(this).attr("data-page"));if(x>0){w+=x+"|"}});i.cookie("repeaters_open",w)}function q(){i(".InputfieldRepeater").each(function(){s(i(this))});i(document).on("reloaded",".InputfieldRepeater",c).on("click",".InputfieldRepeaterTrash",k).on("dblclick",".InputfieldRepeaterTrash",n).on("click",".InputfieldRepeaterClone",e).on("dblclick",".InputfieldRepeaterToggle",p).on("click",".InputfieldRepeaterToggle",r).on("opened",".InputfieldRepeaterItem",u).on("closed",".InputfieldRepeaterItem",j).on("openReady",".InputfieldRepeaterItem",f)}q()}jQuery(document).ready(function(a){InputfieldRepeater(a)});